# Livemd2exs

Converts Livebook (`.livemd`) files to executable Elixir scripts (`.exs`).

This can be used in a Livebook regression test system -- convert your Livebooks
to scripts and run them as part of your test suite to catch breaking changes.

Only Elixir code blocks are extracted. Text blocks, markdown headings, and all
other non-code content are discarded.

## Command-Line Usage

```bash
# Output to stdout
livemd2exs notebook.livemd

# Write to a file
livemd2exs notebook.livemd -o output.exs
livemd2exs notebook.livemd > output.exs 
```

The generated script includes a shebang header with a timestamp and source path:

```elixir
#! /usr/bin/env elixir
#
# Generated by `livemd2exs` on 2026-01-31 12:00:00 UTC
# livemd input: notebook.livemd
#

# ... extracted code blocks ...
```

## Library Usage

```elixir
# Generate a script string from a Livebook file
script = Livemd2exs.extract("path/to/notebook.livemd")

# Write it to a file
File.write!("output.exs", script)
```

## Installation

### As a command-line tool

Clone the repo and build the escript:

```bash
git clone <repo-url> livemd2exs
cd livemd2exs
mix deps.get
mix escript.build
```

Then copy the `livemd2exs` binary to a directory on your `PATH`:

```bash
cp livemd2exs ~/.local/bin/
```

### As a library dependency

Add `livemd2exs` to your list of dependencies in `mix.exs`:

```elixir
def deps do
  [
    {:livemd2exs, github: "andyl/livemd2exs"}
  ]
end
```

Then run:

```bash
mix deps.get && mix compile
```

## How It Works

1. The `.livemd` file is read and parsed into an AST using [Earmark](https://hex.pm/packages/earmark)
2. The AST is filtered for `<pre>` elements (fenced code blocks)
3. Nested code content is extracted from Earmark's `{"pre", _, [{"code", _, [text], _}], _}` structure
4. Code blocks are joined with blank line separators
5. A header with shebang, timestamp, and source path is prepended

## Dependencies

- [Earmark](https://hex.pm/packages/earmark) ~> 1.4 -- Markdown parsing

## Contributing

Pull requests are welcome! If you find a bug, have a feature idea, or want to
improve the code, feel free to open an issue or submit a PR.

Please use [Conventional Commits](https://www.conventionalcommits.org/) for all
commit messages. Examples:

- `feat: Add text-to-comments conversion option`
- `fix: Handle empty code blocks without crashing`
- `docs: Update installation instructions`

## License

MIT License. See [LICENSE](LICENSE) for details.
